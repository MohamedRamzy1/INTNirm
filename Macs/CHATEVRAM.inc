CHATEVRAM MACRO

    CALL PrepareScreen
	CALL PORTINIT	
	evramsend:
			;FIRST WE NEED TO CHECK IF THERE'S SOMETHING THE MAIN USER TYPED OR SHOULD WE RECEIVE
			MOV AH,01 ;PEEK
			INT 16H
			JZ evramrec

			;READ STRING AND STORE IT IN MYMSG
			;FREE UP MYMSG FIRST
			MOV CX,79
			LEA SI,MYMSG
			ADD SI,2
			LOOPTHISTOFREE:
	     	MOV [SI],'$'
			INC SI
			LOOP LOOPTHISTOFREE
			
			CALL EVRAMREADMYMESSAGE 
		LoopToSend:			
		   ;LOOP ON MYMSG, CHECK FOR EACH CHARACTER
		   LEA SI,MyMSG
		   ;LOOP ON EACH CHAR
		   LOOPTPSEND:
		   ;CHECK IF THE SENDING BUFFER IS AVAILABLE FOR OUR CHAR
		   CALL CHECKTOSENDevram                                      
		   ;SEND THE CHAR
		   MOV DX,3F8H
		   MOV AL,[SI]
		   OUT DX,AL     
		   ;ITERATE ON THE NEXT CHAR    
		   INC SI                   
		   ;IS IT THE END?
		   CMP AL,'$'
		   ;YES
		   JZ evramrec         
		   ;NO
		   JNZ LOOPTPSEND

		evramrec: 
			;HERE WE STORE WHAT WE RECIEVE
			LOOPTOREC:
			;CHANGE THE CURSOR TO WHERE YOU WISH TO TYPE YOUR RECEIVED MESSAGE
			MOV DL,HISPOS
			SUB DL,2
			MOV DH,HISLINES
			MOV AH,2
			INT 10H

			;CHECK IF ANYTHING TO RECEIVE
			MOV DX,03FDH
			IN AL,DX
			AND AL,1
			JZ evramsend

			;RECEIVE IT
			MOV DX,03F8H
			IN AL,DX

			CMP HISPOS,2
			JC RIGHTHERE
			;VALUE KEPT IN AL
			;IS IT THE END?
			CMP AL,'$'
			JZ READY

			;DISPLAY CHAR

			MOV DL,AL
			MOV AH,2
			INT 21H

			RIGHTHERE:

			INC HISPOS

			JMP LOOPTOREC

			READY:

			;WAIT A SEC
			MOV AH,86H
			MOV CX,0
			MOV DX,0110H
			INT 15H

			CALL WRITEHISMSG

			returnhere1:
			CMP BOOLEV,1
			JZ ContinueSend
		
		ev2:
		JMP evramsend


ENDM CHATEVRAM



